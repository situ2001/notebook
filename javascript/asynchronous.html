<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Asynchronous | Situ Book</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo-book.svg">
    <link rel="stylesheet" href="/katex.min.css">
    <meta name="description" content="Taking notes">
    
    <link rel="preload" href="/assets/css/0.styles.d8aad553.css" as="style"><link rel="preload" href="/assets/js/app.5b1f2b96.js" as="script"><link rel="preload" href="/assets/js/2.5c3c5d4d.js" as="script"><link rel="preload" href="/assets/js/5.162f3eb8.js" as="script"><link rel="prefetch" href="/assets/js/10.49460d92.js"><link rel="prefetch" href="/assets/js/11.4541e06f.js"><link rel="prefetch" href="/assets/js/12.f19a741e.js"><link rel="prefetch" href="/assets/js/13.13ab00de.js"><link rel="prefetch" href="/assets/js/14.b2138dfa.js"><link rel="prefetch" href="/assets/js/15.faaa9bff.js"><link rel="prefetch" href="/assets/js/16.51255ee5.js"><link rel="prefetch" href="/assets/js/17.23ac229b.js"><link rel="prefetch" href="/assets/js/18.f7813b5a.js"><link rel="prefetch" href="/assets/js/19.a0acb39d.js"><link rel="prefetch" href="/assets/js/20.10b7d914.js"><link rel="prefetch" href="/assets/js/21.36d745cc.js"><link rel="prefetch" href="/assets/js/22.982fbe30.js"><link rel="prefetch" href="/assets/js/23.c9dceea9.js"><link rel="prefetch" href="/assets/js/24.8c341e17.js"><link rel="prefetch" href="/assets/js/25.930e6b1c.js"><link rel="prefetch" href="/assets/js/26.188c0641.js"><link rel="prefetch" href="/assets/js/27.7922c69a.js"><link rel="prefetch" href="/assets/js/28.fa61ffc5.js"><link rel="prefetch" href="/assets/js/29.76b9d662.js"><link rel="prefetch" href="/assets/js/3.3549efa6.js"><link rel="prefetch" href="/assets/js/30.8476d123.js"><link rel="prefetch" href="/assets/js/31.682d142b.js"><link rel="prefetch" href="/assets/js/32.576bd71a.js"><link rel="prefetch" href="/assets/js/33.6e25be72.js"><link rel="prefetch" href="/assets/js/34.dc2c4d48.js"><link rel="prefetch" href="/assets/js/35.b28ab3d3.js"><link rel="prefetch" href="/assets/js/36.3dcf7b32.js"><link rel="prefetch" href="/assets/js/37.ad7a23fe.js"><link rel="prefetch" href="/assets/js/38.64e8446f.js"><link rel="prefetch" href="/assets/js/39.23097471.js"><link rel="prefetch" href="/assets/js/4.25d773b5.js"><link rel="prefetch" href="/assets/js/40.3f731bec.js"><link rel="prefetch" href="/assets/js/41.c0ea9bab.js"><link rel="prefetch" href="/assets/js/42.51ea4fd2.js"><link rel="prefetch" href="/assets/js/43.2fe370f7.js"><link rel="prefetch" href="/assets/js/44.3c663250.js"><link rel="prefetch" href="/assets/js/45.203f091a.js"><link rel="prefetch" href="/assets/js/46.188f8e89.js"><link rel="prefetch" href="/assets/js/47.42b63283.js"><link rel="prefetch" href="/assets/js/48.b5546301.js"><link rel="prefetch" href="/assets/js/49.884d10f0.js"><link rel="prefetch" href="/assets/js/50.5e44f909.js"><link rel="prefetch" href="/assets/js/51.a308b499.js"><link rel="prefetch" href="/assets/js/52.2b6b814e.js"><link rel="prefetch" href="/assets/js/53.e68b3598.js"><link rel="prefetch" href="/assets/js/54.fd5fe7df.js"><link rel="prefetch" href="/assets/js/55.71c59799.js"><link rel="prefetch" href="/assets/js/56.16116892.js"><link rel="prefetch" href="/assets/js/57.79ce38ab.js"><link rel="prefetch" href="/assets/js/58.8f822016.js"><link rel="prefetch" href="/assets/js/6.2189f9aa.js"><link rel="prefetch" href="/assets/js/7.28c3ec58.js"><link rel="prefetch" href="/assets/js/8.f147ee77.js"><link rel="prefetch" href="/assets/js/9.ed369c5f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d8aad553.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Situ Book</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://blog.situ2001.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/situ2001" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://blog.situ2001.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/situ2001" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tools</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javascript/problems.html" class="sidebar-link">Problems</a></li><li><a href="/javascript/common_function.html" class="sidebar-link">Common function</a></li><li><a href="/javascript/keywords.html" class="sidebar-link">Keywords</a></li><li><a href="/javascript/built_in_object.html" class="sidebar-link">Built-in Objects</a></li><li><a href="/javascript/function.html" class="sidebar-link">Function</a></li><li><a href="/javascript/object.html" class="sidebar-link">Object</a></li><li><a href="/javascript/asynchronous.html" aria-current="page" class="active sidebar-link">Asynchronous</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/asynchronous.html#intro" class="sidebar-link">Intro</a></li><li class="sidebar-sub-header"><a href="/javascript/asynchronous.html#callback" class="sidebar-link">Callback</a></li><li class="sidebar-sub-header"><a href="/javascript/asynchronous.html#implementation" class="sidebar-link">Implementation</a></li><li class="sidebar-sub-header"><a href="/javascript/asynchronous.html#promise" class="sidebar-link">Promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/asynchronous.html#stage" class="sidebar-link">Stage</a></li><li class="sidebar-sub-header"><a href="/javascript/asynchronous.html#instantiation" class="sidebar-link">Instantiation</a></li><li class="sidebar-sub-header"><a href="/javascript/asynchronous.html#examples" class="sidebar-link">Examples</a></li><li class="sidebar-sub-header"><a href="/javascript/asynchronous.html#async" class="sidebar-link">async</a></li><li class="sidebar-sub-header"><a href="/javascript/asynchronous.html#await" class="sidebar-link">await</a></li></ul></li></ul></li><li><a href="/javascript/iterable.html" class="sidebar-link">Iterable and Generator</a></li><li><a href="/javascript/ecmascript.html" class="sidebar-link">ECMAScript</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C/C++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>课程</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="asynchronous"><a href="#asynchronous" class="header-anchor">#</a> Asynchronous</h1> <h2 id="intro"><a href="#intro" class="header-anchor">#</a> Intro</h2> <p>一般代码是顺序执行的。但是，如果你的页面，要做一点时间长一点的事情(比如说网络请求，读取json等)。那么，在这些事情执行的时候，后面的语句就会在等待，此时整个页面就会冻住。直到执行完前面的语句。</p> <p>一个例子就是<code>alert()</code>这个函数，在点击OK之前，后面的代码都不会被执行，这个函数可以很好地演示同步的缺点。</p> <p>但是此处我们可以用异步，让这些耗时比较长的事情扔到后台执行，等执行完成后，处理callback</p> <p><img src="/assets/img/0_BJ0YjCrj9RSruxbS.4c4761e0.png" alt="diagram"></p> <h2 id="callback"><a href="#callback" class="header-anchor">#</a> Callback</h2> <p>回调函数就是一个函数，用来作为参数，来传给会在后台运行的函数。</p> <blockquote><p>Async callbacks are functions that are specified as arguments when calling a function which will start executing code in the background.</p></blockquote> <h2 id="implementation"><a href="#implementation" class="header-anchor">#</a> Implementation</h2> <p>js运行的主线程只有一条，但目前对于操作系统的理解不是很深刻，我只知道js是单线程非阻式的实现。</p> <p>那大致是怎么样的呢？摘自MDN</p> <blockquote><p>Async operations like promises are put into an event queue, which runs after the main thread has finished processing so that they do not block subsequent JavaScript code from running. The queued operations will complete as soon as possible then return their results to the JavaScript environment.</p></blockquote> <p>看起来要异步执行的操作，先是被存放在一个事件队列里头了，然后再在<strong>主运行线程空闲</strong>的时候来执行。</p> <p>我们也可以用一段代码来试一下，可以在循环<code>console.log()</code>输出114514次一个变量，然后设置一个3秒的<code>setTimeout()</code>来输出hello world</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">114514</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre></div><p>理论上三秒就能执行输出hello world了，但是等了十多秒，也就是for循环结束之后才输出。（这就是在主线程空闲时再执行）</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">114512</span>
<span class="token number">114513</span>
Hello world
</code></pre></div><p>异步的任务是用线程池里头的后台线程来handle的。整个过程如图所示</p> <p><img src="/assets/img/event_loop_nodejs.e5de1bf5.png" alt="Nodejs"></p> <h2 id="promise"><a href="#promise" class="header-anchor">#</a> Promise</h2> <p>Promise都是异步的，这是ES6引进来的新东西</p> <blockquote><p>In essence, it's the browser's way of saying &quot;I promise to get back to you with the answer as soon as I can,&quot; hence the name &quot;promise.&quot;</p></blockquote> <p>Promise表示一个操作的中间状态，可以handle一个在未来才已知的量，在未来这个未知的量变为已知之后，就可以处理它了。</p> <h3 id="stage"><a href="#stage" class="header-anchor">#</a> Stage</h3> <p>Promise对象有三种状态: pending, fulfilled 和 rejected</p> <ul><li>pending: initial state, neither fulfilled nor rejected.</li> <li>fulfilled: meaning that the operation was completed successfully.</li> <li>rejected: meaning that the operation failed.</li></ul> <p><img src="data:image/png;base64,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" alt="Stage"></p> <p>由于方法<code>then()</code>与<code>catch()</code>与<code>finally()</code>都返回一个Promise，这个Promise的result呢...只有<code>then()</code>能更改Promise对象的resolved value。因此Promise可以被链式调用。像这样</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> calc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">val</span> <span class="token operator">=&gt;</span> val <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">val</span> <span class="token operator">=&gt;</span> val <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">val</span> <span class="token operator">=&gt;</span> val <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">val</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 65536</span>
</code></pre></div><p>其中，<code>then()</code>中的参数<code>onRejection</code>是可选的，error也可以由<code>catch(onRejection)</code>来handle</p> <h3 id="instantiation"><a href="#instantiation" class="header-anchor">#</a> Instantiation</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// the function is executed automatically when the promise is constructed</span>

  <span class="token comment">// after 1 second signal that the job is done with the result &quot;done&quot;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// or done with the result &quot;error&quot;</span>
  <span class="token comment">// setTimeout(() =&gt; reject(&quot;error&quot;, 1000));</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当Promise对象得到结果之后，必是下面两者之一</p> <ul><li><code>resolve(value)</code> — if the job finished successfully, with result <code>value</code>.</li> <li><code>reject(error)</code> — if an error occurred, error is the error <code>object</code>.</li></ul> <p><img src="/assets/img/promise_executor.792493dc.jpg" alt="Executor"></p> <h3 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h3> <p>由于Promise保证了是异步，因此就算是看起来可以马上被执行的函数，也只会在栈空了、过了一个clock-tick之后被执行</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promiseA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token parameter">resolutionFunc<span class="token punctuation">,</span>rejectionFunc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolutionFunc</span><span class="token punctuation">(</span><span class="token number">777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// At this point, &quot;promiseA&quot; is already settled.</span>
promiseA<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;asynchronous logging has val:&quot;</span><span class="token punctuation">,</span>val<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;immediate logging&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// produces output in this order:</span>
<span class="token comment">// immediate logging</span>
<span class="token comment">// asynchronous logging has val: 777</span>
</code></pre></div><hr> <ul><li>与callback的区别</li></ul> <blockquote><p>Promises have some similarities to old-style callbacks. <strong>They are essentially a returned object to which you attach callback functions, rather than having to pass callbacks into a function.</strong></p></blockquote> <p>它们本质都是一个返回的对象，我们可以将回调函数附加到该对象上，而不必将回调作为参数传递给另一个函数。</p> <hr> <h3 id="async"><a href="#async" class="header-anchor">#</a> async</h3> <p>加<code>async</code>的函数，就会是一个Promise-based function，返回值就会是一个Promise</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> <span class="token function-variable function">hello</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;Hello&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;fulfilled&gt;: &quot;hello&quot;}</span>
<span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// hello</span>
</code></pre></div><h3 id="await"><a href="#await" class="header-anchor">#</a> await</h3> <blockquote><p>The await operator is used to wait for a Promise</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span>rv<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> expression<span class="token punctuation">;</span>
<span class="token comment">// rv: Returns the fulfilled value of the promise, or the value itself if it's not a Promise.</span>
<span class="token comment">// expression: A Promise or any value to wait for.</span>
</code></pre></div><p>在Promise-based的函数调用前，加await，可以让code暂时停下，直到这个promise被fulfill，并返回结果的值，<strong>而不是Promise</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// a function that returns a Promise</span>
<span class="token keyword">function</span> <span class="token function">resolveAfter2Seconds</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// works only inside async functions</span>
  <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">resolveAfter2Seconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
<span class="token punctuation">}</span>

<span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>而如果把await去掉,就会打印出 <code>Promise {&lt;pending&gt;}</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token function">resolveAfter2Seconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// await was removed</span>
</code></pre></div><p>还可以直接get到thenable对象的值...thenable可以是一个对象，但是这个对象里头有<code>then</code>函数，并且函数的样子长得很像一个Promise的话。那<code>await</code>就会把它当成一个Promise。</p> <p>一般可以用来做自定义</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> <span class="token function-variable function">show</span> <span class="token operator">=</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Thenable</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> num<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">show</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Function (anonymous)]</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Thenable</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>show<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// shows 2 after 1000ms</span>
</code></pre></div><p><code>await</code>还可以把<code>reject()</code>的给catch住，不过暂时还不知道有什么用...</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">114514</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 114514</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/javascript/object.html" class="prev">
        Object
      </a></span> <span class="next"><a href="/javascript/iterable.html">
        Iterable and Generator
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5b1f2b96.js" defer></script><script src="/assets/js/2.5c3c5d4d.js" defer></script><script src="/assets/js/5.162f3eb8.js" defer></script>
  </body>
</html>
